# 插件的加载流出

## XML 方式：

插件的加载原理是：Mybatis在初始化的时候，通过XMLConfigBuilder解析配置文件中的plugins标签通过反射机制， 把plugin标签对应的拦截器属性进行实例化，并且加载到拦截器链里面。

## 加载

* 在四大对象创建的时候
* 1、每个创建出来的对象不是直接返回的，而是
*      interceptorChain.pluginAll(parameterHandler);
* 2、获取到所有的Interceptor（拦截器）（插件需要实现的接口）；
*      调用interceptor.plugin(target);返回target包装后的对象
* 3、插件机制，我们可以使用插件为目标对象创建一个代理对象；AOP（面向切面）
*      我们的插件可以为四大对象创建出代理对象；
*      代理对象就可以拦截到四大对象的每一个执行；

> pluginAll() 方法包一层把所有的拦截器插入到目标类

## 总结：

创建动态代理的时候 是按照插件配置顺序创建层层代理对象

执行目标方法，是按逆向顺序执行的