## [原文1](https://zhuanlan.zhihu.com/p/36054372)

## [原文2](https://www.jianshu.com/p/7bb52818b8a9)

# 如何实现负载均衡,有哪些算法可以实现?

负载均衡，英文名称为Load Balance

## 负载均衡的基本概念

负载均衡是指，`将请求分发到 多台 应用服务器`，以此来分散 压力的一种架构方式， 他是以集群的方式存在，并且当 某个节点挂掉的时候，可以自动 不再将请求分配到此节点。

## 有哪些负载均衡技术？

负载均衡器主要分为`硬件`负载均衡和`软件`负载均衡两大类。

### 硬件负载均衡技术

比如最常见的就是F5负载均衡器

优点： 能够直接通过智能交换机实现,处理能力更强，而且与系统无关，负载性能强

缺点：成本高，除设备价格高昂，而且配置冗余

### 软件负载均衡技术

主流的软件负载均衡器有LVS、Nginx和HAproxy。

优点：复杂应用下，软件负载均衡能够根据系统与应用情况来分配业务负载，效率很高。 性价比很高，对于一些只需要几台服务器就能支撑的业务，使用软件负载均衡技术更加合适。

缺点：负载能力受服务器本身性能的影响，性能越好，负载能力越大。

LVS：内核态转发型的高可用工具，是一种基于传输层的负载均衡器，主要原理就是对网络数据报文做些更改， 然后进行转发,支持的状态检测方法也比较完善，有端口检测，url检测和自定义脚本检测。
抗负载能力强，性能高，稳定性高，可靠性高，自身有完美的热备方案(Keepalived+lvs)。

Nginx：工作在网络层和应用层，主流的反向代理软件，可以通过代理的功能实现负载均衡的功能， 本身功能比较完善，既可以做静态站点，缓存又可以做负载均衡器，配置上可以优化的地方很多，
有端口检测和url的检测，但是检测的方式是被动式的，会对用户的访问造成一定的影响。

HAproxy：工作在TCP层和HTTP层，支持虚拟机，支持Session的保持，Cookie的引导， 同时支持通过获取指定的url来检测后端服务器的状态。单纯从效率上来看，优于Nginx。

## 负载均衡算法

### 1. 轮询（Round Robin，RR）

将请求按顺序轮流地分配到后端服务器上，它均衡地对待后端的每一台服务器，而不关心服务器实际的连接数和当前的系统负载。

### 2. 随机（Random）

通过系统的随机算法，根据后端服务器的列表大小值来随机选取其中的一台服务器进行访问。 由概率统计理论可以得知，随着客户端调用服务端的次数增多，

其实际效果越来越接近于平均分配调用量到后端的每一台服务器，也就是轮询的结果。

### 3. 源地址散列（Source hashing）

根据请求来源的IP地址进行Hash计算，得到应用服务器，这样来自同一个IP地址的请求总在同一个服务器上处理， 该请求的上下文信息可以存储在这台服务器上，在一个会话周期内重复使用，从而实现会话黏滞。

### 4. 加权轮询（Weighted Round Robin，WRR）

不同的后端服务器可能机器的配置和当前系统的负载并不相同，因此它们的抗压能力也不相同。 给配置高、负载低的机器配置更高的权重，让其处理更多的请；而配置低、负载高的机器，
给其分配较低的权重，降低其系统负载，加权轮询能很好地处理这一问题，并将请求顺序且按照权重分配到后端。

### 5. 加权随机法

与加权轮询法一样，加权随机法也根据后端机器的配置，系统的负载分配不同的权重。 不同的是，它是按照权重随机请求后端服务器，而非顺序。

### 6. 最少连接（Least Connections）

最小连接数算法比较灵活和智能，由于后端服务器的配置不尽相同，对于请求的处理有快有慢， 它是根据后端服务器当前的连接情况，动态地选取其中当前 积压连接数最少的一台服务器来处理当前的请求，
尽可能地提高后端服务的利用效率，将负责合理地分流到每一台服务器。