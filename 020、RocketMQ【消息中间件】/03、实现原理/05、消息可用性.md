
## [原文1](http://jm.taobao.org/2017/01/12/rocketmq-quick-start-in-10-minutes/)

## [参考](http://silence.work/2019/05/04/RocketMQ%20Reliablity/)


# 消息可用性

影响消息可靠性的几种情况：

1. Broker正常关闭
2. Broker异常Crash
3. OS Crash
4. 机器掉电，但是能立即恢复供电情况。
5. 机器无法开机（可能是cpu、主板、内存等关键设备损坏）
6. 磁盘设备损坏。

(1)、(2)、(3)、(4)四种情况都属于硬件资源可立即恢复情况，RocketMQ在这四种情况下能保证消息不丢，
或者丢失少量数据（依赖刷盘方式是同步还是异步）。

(5)、(6)属于单点故障，且无法恢复，一旦发生，在此单点上的消息全部丢失。RocketMQ在这两种情况下，
通过`异步复制`，可保证99%的消息不丢，但是仍然会有极少量的消息可能丢失。
通过`同步双写技术`可以完全避免单点，同步双写势必会影响性能，`适合对消息可靠性要求极高的场合`，例如与Money相关的应用。

RocketMQ从3.0版本开始支持同步双写。


## 消息的幂等性
说到消息消费不得不提到消息的`幂等性`，业务代码中通常收到一条消息进行一次业务逻辑处理，
如果一条相同的消息被重复收到几次，是否会导致业务重复处理？
Consumer 能够不重复接收消息？
`RocketMQ 不保证消息不被重复消费`，如果业务对消息重复消费非常敏感，必须要在业务层面进行幂等性处理，
具体实现可以通过`分布式锁来完成`。


